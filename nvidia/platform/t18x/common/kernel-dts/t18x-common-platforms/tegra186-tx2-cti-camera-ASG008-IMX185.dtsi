    

#include <t18x-common-platforms/tegra186-tx2-cti-camera-base.dtsi>
#include "dt-bindings/clock/tegra186-clock.h"


/* camera control gpio definitions */

#define CAM0_RST_L  TEGRA_MAIN_GPIO(R, 5)
#define CAM0_PWDN   TEGRA_MAIN_GPIO(R, 0)


/ {
    
    gpio@2200000 {
        camera-control-output-low {
            gpio-hog;
            output-low;
            gpios = <CAM0_RST_L 0 CAM0_PWDN 0>;
            label = "cam0-rst", "cam0-pwdn";
        };
    };


/**********************SENSORS******************************************************************/

	i2c@3180000 {   
        imx185_a@1a {
            compatible = "nvidia,imx185";
            reg = <0x1a>;
            devnode = "video0";

            /* Physical dimensions of sensor */
            physical_w = "15";
            physical_h = "12.5";
            clocks = <&tegra_car TEGRA186_CLK_EXTPERIPH1>,
                     <&tegra_car TEGRA186_CLK_PLLP_OUT0>;
            clock-names = "extperiph1", "pllp_grtba";
            mclk = "extperiph1";
            sensor_model = "imx185";

            post_crop_frame_drop = "0";
            use_decibel_gain = "true";
            delayed_gain = "true";
            use_sensor_mode_id = "true";


            reset-gpios = <&tegra_main_gpio CAM0_RST_L GPIO_ACTIVE_HIGH>;
            vcc-supply = <&battery_reg>;
            vcc_lp = "vcc";

            mode0 {/*mode IMX185_MODE_1920X1080_CROP_30FPS*/
                    mclk_khz = "37125";
                    num_lanes = "4";
                    tegra_sinterface = "serial_a";
                    discontinuous_clk = "no";
                    dpcm_enable = "false";
                    cil_settletime = "0";
                    dynamic_pixel_bit_depth = "12";
                    csi_pixel_bit_depth = "12";
                    mode_type = "bayer";
                    pixel_phase = "rggb";
                    pixel_t = "bayer_rggb";

                    active_w = "1920";
                    active_h = "1080";
                    readout_orientation = "0";
                    line_length = "2200";
                    inherent_gain = "1";
                    mclk_multiplier = "2";
                    pix_clk_hz = "74250000";

                    min_gain_val = "0"; /* dB */
                    max_gain_val = "48"; /* dB */
                    min_hdr_ratio = "1";
                    max_hdr_ratio = "1";
                    min_framerate = "1.5";
                    max_framerate = "30";
                    min_exp_time = "30";
                    max_exp_time = "660000";
                    embedded_metadata_height = "1";
            };


            mode1 {/*mode IMX185_MODE_1920X1080_CROP_10BIT_30FPS*/
                    mclk_khz = "37125";
                    num_lanes = "4";
                    tegra_sinterface = "serial_a";
                    discontinuous_clk = "no";
                    dpcm_enable = "false";
                    cil_settletime = "0";
                    dynamic_pixel_bit_depth = "10";
                    csi_pixel_bit_depth = "10";
                    mode_type = "bayer";
                    pixel_phase = "rggb";
                    pixel_t = "bayer_rggb";

                    active_w = "1920";
                    active_h = "1080";
                    readout_orientation = "0";
                    line_length = "2640";
                    inherent_gain = "1";
                    mclk_multiplier = "2.4";
                    pix_clk_hz = "89100000";

                    min_gain_val = "0";
                    max_gain_val = "48";
                    min_hdr_ratio = "1";
                    max_hdr_ratio = "1";
                    min_framerate = "1.5";
                    max_framerate = "30";
                    min_exp_time = "30";
                    max_exp_time = "660000";
                    embedded_metadata_height = "1";
            };
            mode2 {/*mode IMX185_MODE_1920X1080_CROP_60FPS*/
                    mclk_khz = "37125";
                    num_lanes = "4";
                    tegra_sinterface = "serial_a";
                    discontinuous_clk = "no";
                    dpcm_enable = "false";
                    cil_settletime = "0";
                    dynamic_pixel_bit_depth = "12";
                    csi_pixel_bit_depth = "12";
                    mode_type = "bayer";
                    pixel_phase = "rggb";
                    pixel_t = "bayer_rggb";
                    active_w = "1920";
                    active_h = "1080";
                    readout_orientation = "0";
                    line_length = "2200";
                    inherent_gain = "1";
                    mclk_multiplier = "4";
                    pix_clk_hz = "148500000";

                    min_gain_val = "0";
                    max_gain_val = "48";
                    min_hdr_ratio = "1";
                    max_hdr_ratio = "1";
                    min_framerate = "1.5";
                    max_framerate = "60";
                    min_exp_time = "30";
                    max_exp_time = "660000";
                    embedded_metadata_height = "1";
                };
                mode3 {/*mode IMX185_MODE_1920X1080_CROP_10BIT_60FPS*/
                    mclk_khz = "37125";
                    num_lanes = "4";
                    tegra_sinterface = "serial_a";
                    discontinuous_clk = "no";
                    dpcm_enable = "false";
                    cil_settletime = "0";
                    dynamic_pixel_bit_depth = "10";
                    csi_pixel_bit_depth = "10";
                    mode_type = "bayer";
                    pixel_phase = "rggb";
                    pixel_t = "bayer_rggb";
                    active_w = "1920";
                    active_h = "1080";
                    readout_orientation = "0";
                    line_length = "2640";
                    inherent_gain = "1";
                    mclk_multiplier = "4.8";
                    pix_clk_hz = "178200000";

                    min_gain_val = "0";
                    max_gain_val = "48";
                    min_hdr_ratio = "1";
                    max_hdr_ratio = "1";
                    min_framerate = "1.5";
                    max_framerate = "60";
                    min_exp_time = "30";
                    max_exp_time = "660000";
                    embedded_metadata_height = "1";
                };
                mode4 {/*mode IMX185_MODE_1920X1080_CROP_HDR_30FPS*/
                    mclk_khz = "37125";
                    num_lanes = "4";
                    tegra_sinterface = "serial_a";
                    discontinuous_clk = "no";
                    dpcm_enable = "false";
                    cil_settletime = "0";
                    dynamic_pixel_bit_depth = "16";
                    csi_pixel_bit_depth = "12";
                    mode_type = "bayer_wdr_pwl";
                    pixel_phase = "rggb";
                    active_w = "1920";
                    active_h = "1080";
                    readout_orientation = "0";
                    line_length = "2200";
                    inherent_gain = "1";
                    mclk_multiplier = "2";
                    pix_clk_hz = "74250000";

                    min_gain_val = "0";
                    max_gain_val = "12";
                    min_hdr_ratio = "16";
                    max_hdr_ratio = "16";
                    min_framerate = "1.5";
                    max_framerate = "30";
                    min_exp_time = "30";
                    max_exp_time = "660000";
                    embedded_metadata_height = "1";

                    /* WDR related settings */
                    num_control_point = "4";
                    control_point_x_0 = "0";
                    control_point_x_1 = "2048";
                    control_point_x_2 = "16384";
                    control_point_x_3 = "65536";
                    control_point_y_0 = "0";
                    control_point_y_1 = "2048";
                    control_point_y_2 = "2944";
                    control_point_y_3 = "3712";
                };



            ports {
                #address-cells = <1>;
                #size-cells = <0>;

                port@0 {
                    reg = <0>;
                    imx185_out0: endpoint {
                        csi-port = <0>;
                        bus-width = <4>;
                        remote-endpoint = <&csi_in0>;
                    };
                };
            };
        };

        pca9570_a@24 {
            compatible = "nvidia,pca9570";
            reg = <0x24>;
            channel = "a";
            drive_ic= "DRV8838";
        };

    };

/**********************VI******************************************************************/

     host1x {
        vi@15700000 {
            num-channels = <1>; //set number of channels
            status = "okay";
            ports {
                port@0 {
                    status = "okay";
                    endpoint {
                        status = "okay";
                        csi-port = <0>;
                        bus-width = <4>;
                        remote-endpoint = <&csi_out0>; 
                    };
                };
            };
        }; 

/**********************CSI******************************************************************/
        nvcsi@150c0000 {
            num-channels = <1>;

            channel@0 {
                status = "okay";
                ports {
                     port@0 {
                        status = "okay";
                        endpoint@0 {
                            csi-port = <0>;
                            bus-width = <4>;
                            remote-endpoint = <&imx185_out0>; //should be sensor port under i2c endpoint
                            status = "okay";

                        };
                    };
                    port@1 {
                        status = "okay";
                        endpoint@1 {
                            status = "okay";
                            remote-endpoint = <&vi_in0>; 
                        };
                    };
                };
            };
        };
    };
    lens_imx274@A6V26 {
        min_focus_distance = "0.0";
        hyper_focal = "0.0";
        focal_length = "5.00";
        f_number = "2.0";
        aperture = "2.2";
    };

/**********************CAMERA PLATFORM*************************************************************/

    tegra-camera-platform {
        compatible = "nvidia, tegra-camera-platform";
        /**
        * Physical settings to calculate max ISO BW
        *
        * num_csi_lanes = <>;
        * Total number of CSI lanes when all cameras are active
        *
        * max_lane_speed = <>;
        * Max lane speed in Kbit/s
        *
        * min_bits_per_pixel = <>;
        * Min bits per pixel
        *
        * vi_peak_byte_per_pixel = <>;
        * Max byte per pixel for the VI ISO case
        *
        * vi_bw_margin_pct = <>;
        * Vi bandwidth margin in percentage
        *
        * max_pixel_rate = <>;
        * Max pixel rate in Kpixel/s for the ISP ISO case
        * Set this to the highest pix_clk_hz out of all available modes.
        *
        * isp_peak_byte_per_pixel = <>;
        * Max byte per pixel for the ISP ISO case
        *
        * isp_bw_margin_pct = <>;
        * Isp bandwidth margin in percentage
        */
        num_csi_lanes = <4>;
        max_lane_speed = <1500000>;
        min_bits_per_pixel = <10>;
        vi_peak_byte_per_pixel = <2>;
        vi_bw_margin_pct = <25>;
        max_pixel_rate = <750000>;
        isp_peak_byte_per_pixel = <5>;
        isp_bw_margin_pct = <25>;

        /**
        * The general guideline for naming badge_info contains 3 parts, and is as follows,
        * The first part is the camera_board_id for the module; if the module is in a FFD
        * platform, then use the platform name for this part.
        * The second part contains the position of the module, ex. “rear” or “front”.
        * The third part contains the last 6 characters of a part number which is found
        * in the module's specsheet from the vender.
        */
        modules {

            module0 {
                badge = "imx185_bottom_liimx185";
                position = "bottom";
                orientation = "0";
                status = "okay";
                drivernode0 {
                    status = "okay";
                    pcl_id = "v4l2_sensor";
                    devname = "imx185 2-001a";
                    proc-device-tree = "/proc/device-tree/i2c@3180000/imx185_a@1a";
                };
                drivernode1 {
                    status = "okay";
                    pcl_id = "v4l2_lens";
                    proc-device-tree = "/proc/device-tree/lens_imx274@A6V26/";
                };
            };
        };
    };
};
